section .text
global main
extern malloc
extern free
extern printf
extern putchar
extern exit
error:
MOV EAX,69
PUSH EAX
CALL putchar
ADD ESP,4*1
MOV EAX,1
PUSH EAX
CALL exit
ADD ESP,4*1
main:
PUSH EBP
MOV EBP,ESP
SUB ESP,4
MOV EAX,13
PUSH EAX
CALL malloc
ADD ESP,4*1
MOV [EBP-4],EAX
M0:
MOV EAX,[EBP-4]
TEST EAX,EAX
SETZ AL
MOVZX EAX,AL
CMP EAX,0
JE M1
JMP error
SUB ESP,1
M1:
MOV EAX,[EBP-4]
MOV EDI,EAX
MOV EAX,65
MOV [EDI],EAX
MOV EAX,[EBP-4]
MOV EBX,1
ADD EAX,EBX
MOV EAX,[EAX]
MOV EAX,[EBP-4]
PUSH EAX
CALL printf
ADD ESP,4*1
MOV EAX,[EBP-4]
PUSH EAX
CALL free
ADD ESP,4*1
MOV EAX,0
JMP .EXIT
.EXIT:
MOV ESP,EBP
POP EBP
RET
